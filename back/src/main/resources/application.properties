# ===============================================
# spring
# ===============================================
spring.application.name=OrakgarakiApplication
server.port=8080
server.servlet.context-path=/api

# ===============================================
# mysql
# ===============================================
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.initialization-fail-timeout=60000
spring.datasource.hikari.validation-timeout=5000

# ===============================================
# JPA
# ===============================================
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ===============================================
# 외부 서비스 연동 설정은 application-prod.properties에서 관리
# ===============================================

# ===============================================
# upload maxi
# ===============================================
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB
spring.servlet.multipart.enabled=true
spring.servlet.multipart.file-size-threshold=0
s3.upload.path=${ORAK_UPLOAD_PATH:${java.io.tmpdir}/orak-upload}
spring.servlet.multipart.location=${s3.upload.path}

# ===============================================
# 공통 로깅 설정 (기본값)
# ===============================================
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=INFO
logging.level.com.ssafy.lab.orak=INFO

# data.sql 초기화 스크립트 로깅 비활성화
logging.level.org.springframework.jdbc.datasource.init=WARN

# Spring Security 인증 로그 비활성화
logging.level.org.springframework.security=INFO

# 로깅 패턴 (공통)
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{traceId},%X{spanId}] %logger{36} - %msg%n
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%X{traceId},%X{spanId}] %logger{36} - %msg%n

# ===============================================
# 모니터링 설정은 application-prod.properties에서 관리
# ===============================================

# ===============================================
# Swagger/OpenAPI
# ===============================================
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.doc-expansion=none
springdoc.swagger-ui.config-url=/api/api-docs/swagger-config
springdoc.swagger-ui.url=/api/api-docs
# ===============================================
# Batch Processing Configuration (백업 처리용 - Kafka 실패 시만 동작)
# ===============================================
processing.batch.enabled=true
processing.batch.max-concurrent-jobs=3
processing.batch.batch-size=5
processing.batch.interval-ms=1800000
processing.batch.retry-attempts=3
processing.batch.retry-delay-ms=5000

# ===============================================
# Thread Pool + Semaphore Configuration
# ===============================================
# WAV 변환 (빠른 처리, 높은 동시성 - 사용자 재생을 위해)
processing.audio.wav-conversion.core-pool-size=5
processing.audio.wav-conversion.max-pool-size=10
processing.audio.wav-conversion.queue-capacity=50
processing.audio.wav-conversion.semaphore-permits=8

# 음성 분석 (무거운 처리, 제한적 동시성 - AI 서버 부하 고려)
processing.audio.voice-analysis.core-pool-size=2
processing.audio.voice-analysis.max-pool-size=4
processing.audio.voice-analysis.queue-capacity=20
processing.audio.voice-analysis.semaphore-permits=2

# 이미지 처리 (중간 처리)
processing.image.core-pool-size=3
processing.image.max-pool-size=6
processing.image.queue-capacity=30
processing.image.semaphore-permits=4

# 배치 처리 (기타 작업)
processing.batch.core-pool-size=2
processing.batch.max-pool-size=4
processing.batch.queue-capacity=25
processing.batch.semaphore-permits=3

# ===============================================
# Kafka DLQ Pattern Configuration
# ===============================================
kafka.dlq.max-retry-attempts=3
kafka.dlq.retry-delay-minutes=5
kafka.dlq.recovery-interval-minutes=30
kafka.dlq.kafka-health-check-threshold=10

# ===============================================
# Audio Processing Configuration
# ===============================================
processing.audio.format-conversion-enabled=true
processing.audio.metadata-extraction-enabled=true
processing.audio.max-processing-time-minutes=10

# ===============================================
# Image Processing Configuration
# ===============================================
processing.image.optimization-enabled=true
processing.image.thumbnail-generation-enabled=true
processing.image.max-width-px=1920
processing.image.max-height-px=1080
processing.image.thumbnail-size-px=300

# ===============================================
# Jackson JSON
# ===============================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=Asia/Seoul
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# UTF-8
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true
server.servlet.encoding.force=true

# ===============================================
# active profile
# ===============================================
spring.profiles.active=${SPRING_PROFILES_ACTIVE}

# ===============================================
# 공통 에러 처리 설정
# ===============================================
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false

# ===============================================
# 외부 서비스 및 환경별 설정은 application-prod.properties에서 관리
# ===============================================